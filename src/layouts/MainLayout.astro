---
import siteData from "../data/site.json";
import "../styles/global.css";
import "aos/dist/aos.css";
---

<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RezCode - Premium Digital Solutions</title>
    <meta
      name="description"
      content="RezCode delivers cutting-edge web solutions with futuristic design and unmatched performance."
    />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href={siteData.logo} />
    <link rel="apple-touch-icon" href={siteData.logo} />

    <!-- AOS Animation Library -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body
    class="bg-brand-dark text-brand-light min-h-screen selection:bg-brand-primary selection:text-white"
  >
    <slot />

    <script>
      import AOS from "aos";

      // Initialize AOS with extreme performance defaults
      AOS.init({
        duration: 400, // Significantly faster for an aggressive feel
        easing: "ease-out-cubic",
        once: false, // Re-enable for fade-in/out on scroll
        mirror: true, // Animates elements out while scrolling past
        offset: 50,
      });

      // Global Optimized Mouse Tracking for Glow Cards
      // Only enable on fine pointers (mouse) to save energy on tablets/phones
      const isTouch = window.matchMedia("(pointer: coarse)").matches;

      if (!isTouch) {
        let frameRequested = false;
        let cards: NodeListOf<Element> | null = null;

        // Cache cards on initial load and potentially on resize/DOM change
        const updateCardCache = () => {
          cards = document.querySelectorAll(".glow-card");
        };

        updateCardCache();

        // Update cache when DOM changes (e.g., after navigation or dynamic loading)
        const observer = new MutationObserver(updateCardCache);
        observer.observe(document.body, { childList: true, subtree: true });

        document.addEventListener("mousemove", (e) => {
          if (frameRequested || !cards || cards.length === 0) return;
          frameRequested = true;

          requestAnimationFrame(() => {
            const mouseX = e.clientX;
            const mouseY = e.clientY;

            cards?.forEach((card: any) => {
              const rect = card.getBoundingClientRect();

              // Only update if card is in viewport
              if (rect.top < window.innerHeight && rect.bottom > 0) {
                const x = mouseX - rect.left;
                const y = mouseY - rect.top;
                card.style.setProperty("--mouse-x", `${x}px`);
                card.style.setProperty("--mouse-y", `${y}px`);
              }
            });
            frameRequested = false;
          });
        });
      }

      // Click Ripple Effect
      document.addEventListener("click", (e) => {
        const ripple = document.createElement("div");
        ripple.classList.add("ripple");

        const size = 100;
        ripple.style.width = `${size}px`;
        ripple.style.height = `${size}px`;
        ripple.style.left = `${e.clientX - size / 2}px`;
        ripple.style.top = `${e.clientY - size / 2}px`;

        document.body.appendChild(ripple);

        setTimeout(() => {
          ripple.remove();
        }, 800);
      });
    </script>
  </body>
</html>
