---
import siteData from "../data/site.json";
import "../styles/global.css";
import "aos/dist/aos.css";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0"
    />
    <title>RezCode - Premium Digital Solutions</title>
    <meta
      name="description"
      content="RezCode delivers cutting-edge web solutions with futuristic design and unmatched performance."
    />

    <meta name="theme-color" content="#0c0f19" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />

    <link rel="icon" type="image/png" href={siteData.logo} />
    <link rel="apple-touch-icon" href={siteData.logo} />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />
    <link
      rel="preload"
      href="https://fonts.gstatic.com/s/outfit/v11/QGYsz_ueSjtS_O7xMA.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <style is:inline>
      :root {
        --color-brand-dark: #0c0f19;
        --color-brand-primary: #3b65a4;
        --color-brand-secondary: #4080bf;
        --color-brand-light: #f8fbfd;
      }
      /* Mencegah layar putih saat browser pertama kali me-render */
      html,
      body {
        background-color: #0c0f19 !important;
        margin: 0;
        padding: 0;
      }
      body {
        color: #f8fbfd;
        font-family: "Outfit", sans-serif;
      }
    </style>

    <link rel="preload" href="/logo.png" as="image" />
    <link rel="manifest" href="/manifest.json" />
  </head>
  <body
    class="bg-brand-dark text-brand-light min-h-screen selection:bg-brand-primary selection:text-white"
  >
    <slot />

    <script>
      import AOS from "aos";

      // Initialize AOS dengan offset lebih kecil untuk Mobile agar tidak telat muncul
      window.addEventListener("load", () => {
        setTimeout(() => {
          AOS.init({
            duration: 500,
            easing: "ease-out-cubic",
            once: true,
            offset: 20, // Animasi muncul lebih cepat saat di-scroll
            disable: window.innerWidth < 768 ? "mobile" : false, // Opsional: matikan jika masih lag
          });
        }, 100);
      });

      const isTouch = window.matchMedia("(pointer: coarse)").matches;

      if (!isTouch) {
        let frameRequested = false;
        let cards: { el: HTMLElement; rect: DOMRect }[] = [];

        const cardObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              const el = entry.target as HTMLElement;
              if (entry.isIntersecting) {
                cards.push({ el, rect: el.getBoundingClientRect() });
              } else {
                cards = cards.filter((c) => c.el !== el);
              }
            });
          },
          { threshold: 0 },
        );

        const updateCardCache = () => {
          document.querySelectorAll(".glow-card").forEach((card) => {
            cardObserver.observe(card);
          });
        };

        updateCardCache();

        window.addEventListener(
          "scroll",
          () => {
            cards.forEach((c) => {
              c.rect = c.el.getBoundingClientRect();
            });
          },
          { passive: true },
        );

        document.addEventListener("mousemove", (e) => {
          if (frameRequested || cards.length === 0) return;
          frameRequested = true;
          requestAnimationFrame(() => {
            const mouseX = e.clientX;
            const mouseY = e.clientY;
            cards.forEach((card) => {
              const x = mouseX - card.rect.left;
              const y = mouseY - card.rect.top;
              card.el.style.setProperty("--mouse-x", `${x}px`);
              card.el.style.setProperty("--mouse-y", `${y}px`);
            });
            frameRequested = false;
          });
        });
      }

      // Click Ripple Effect
      document.addEventListener("click", (e) => {
        const ripple = document.createElement("div");
        ripple.classList.add("ripple");
        const size = 100;
        ripple.style.width = `${size}px`;
        ripple.style.height = `${size}px`;
        ripple.style.left = `${e.clientX - size / 2}px`;
        ripple.style.top = `${e.clientY - size / 2}px`;
        document.body.appendChild(ripple);
        setTimeout(() => ripple.remove(), 800);
      });
    </script>
  </body>
</html>
